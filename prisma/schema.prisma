// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Event {
  id          String    @id @default(cuid())
  title       String
  description String?
  venue       String
  date        DateTime
  totalSeats  Int       @default(0)
  imageUrl    String?
  // Seating configuration
  leftRows          Int       @default(6) // Number of rows in left section
  leftCols          Int       @default(5) // Number of columns in left section
  rightRows         Int       @default(6) // Number of rows in right section
  rightCols         Int       @default(5) // Number of columns in right section
  backRows          Int       @default(0) // Number of rows in back section
  backCols          Int       @default(0) // Number of columns in back section
  // Flexible seating configuration (new model)
  seatsPerRow       Int       @default(0) // Total seats per row (0 = use old LEFT/RIGHT model)
  aisleAfterSeat    Int       @default(0) // Aisle after this seat number (0 = no aisle)
  backAisleAfterSeat Int      @default(0) // Aisle in back section row (0 = no aisle)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  seats       Seat[]
  bookings    Booking[]
}

model Seat {
  id           String    @id @default(cuid())
  eventId      String
  event        Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  row          String
  number       Int
  section      String    @default("LEFT") // LEFT, RIGHT, or RANG
  status       String    @default("AVAILABLE")
  bookedBy     String?
  bookedAt     DateTime?
  ticketNumber String?   @unique // Unique ticket number for each booked seat
  bookingId    String?
  booking      Booking?  @relation(fields: [bookingId], references: [id], onDelete: SetNull)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@unique([eventId, section, row, number])
  @@index([eventId])
  @@index([bookingId])
}

model Booking {
  id                String   @id @default(cuid())
  eventId           String
  event             Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  customerFirstName String
  customerLastName  String
  sellerFirstName   String
  sellerLastName    String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  seats             Seat[]

  @@index([eventId])
}
